<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ How Chess Pieces Move - Master Every Movement!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            color: #4a5568;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .piece-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .piece-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            border: none;
            padding: 15px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            min-width: 120px;
        }

        .piece-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .piece-btn.active {
            background: linear-gradient(45deg, #e17055, #fdcb6e);
            transform: scale(1.05);
        }

        .demo-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 2px;
            margin: 20px auto;
            background: #8b4513;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid #333;
            width: min(90vw, 480px);
            height: min(90vw, 480px);
            max-width: 480px;
            max-height: 480px;
        }

        .demo-square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 4vw, 2rem);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            border: 1px solid #999;
            aspect-ratio: 1;
        }

        .demo-square.white {
            background: #f0d9b5;
        }

        .demo-square.black {
            background: #b58863;
        }

        .demo-square.piece-here {
            background: #4caf50 !important;
            border: 3px solid #2e7d32;
        }

        .demo-square.can-move {
            background: #ffeb3b !important;
            border: 2px solid #f57f17;
        }

        .demo-square.can-capture {
            background: #ff5722 !important;
            border: 2px solid #d84315;
        }

        .demo-square:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #e91e63, #f06292);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .movement-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .movement-rules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .rule-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
        }

        .rule-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .rule-card ul {
            list-style: none;
            padding: 0;
        }

        .rule-card li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .rule-card li:before {
            content: "‚≠ê";
            position: absolute;
            left: 0;
        }

        .special-moves {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .special-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .special-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .special-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .special-card.learned::after {
            content: "‚úÖ";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .special-card .emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .quiz-section {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .quiz-question-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .quiz-question-container h3 {
            color: white;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-weight: bold;
            border: 2px solid transparent;
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .quiz-option.correct {
            background: #d4edda !important;
            border: 2px solid #28a745 !important;
            color: #155724;
        }

        .quiz-option.incorrect {
            background: #f8d7da !important;
            border: 2px solid #dc3545 !important;
            color: #721c24;
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .option-letter {
            background: #74b9ff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 14px;
            font-weight: bold;
        }

        .quiz-option.correct .option-letter {
            background: #28a745;
        }

        .quiz-option.incorrect .option-letter {
            background: #dc3545;
        }

        .quiz-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .quiz-result.show {
            opacity: 1;
        }

        .quiz-result.correct {
            background: rgba(40, 167, 69, 0.2);
            color: #d4edda;
            border: 1px solid #28a745;
        }

        .quiz-result.incorrect {
            background: rgba(220, 53, 69, 0.2);
            color: #f8d7da;
            border: 1px solid #dc3545;
        }

        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            border: 2px solid #dee2e6;
            font-size: 0.9rem;
        }

        .celebration {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .celebration.show {
            opacity: 1;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .section {
                padding: 20px;
                margin: 15px 0;
            }

            .header {
                padding: 20px;
            }

            .piece-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .piece-btn {
                padding: 12px 15px;
                font-size: 14px;
                min-width: auto;
            }

            .demo-board {
                width: min(95vw, 350px);
                height: min(95vw, 350px);
                padding: 8px;
            }

            .controls {
                gap: 10px;
            }

            .control-btn {
                padding: 10px 15px;
                font-size: 14px;
            }

            .movement-rules {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .special-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .special-card {
                padding: 20px;
            }

            .special-card .emoji {
                font-size: 2.5em;
            }

            .quiz-question-container {
                padding: 15px;
            }

            .quiz-option {
                padding: 12px 15px;
                font-size: 14px;
            }

            .option-letter {
                width: 25px;
                height: 25px;
                margin-right: 10px;
                font-size: 12px;
            }

            .debug-info {
                font-size: 0.8rem;
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .piece-buttons {
                grid-template-columns: repeat(3, 1fr);
            }

            .piece-btn {
                padding: 10px;
                font-size: 12px;
            }

            .demo-board {
                width: min(98vw, 300px);
                height: min(98vw, 300px);
                padding: 5px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 100%;
                max-width: 200px;
            }

            .celebration {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="goBack()">‚¨ÖÔ∏è Back to Chess Kingdom</button>
        
        <div class="header">
            <h1>üöÄ Master Chess Piece Movements!</h1>
            <p style="font-size: 1.2em; color: #666;">Learn how each piece moves and become a movement master!</p>
        </div>

        <div class="section">
            <h2>üéØ Choose a Piece to Practice</h2>
            <div class="piece-buttons">
                <button class="piece-btn active" onclick="selectPiece('pawn')">‚ôüÔ∏è Pawn</button>
                <button class="piece-btn" onclick="selectPiece('rook')">‚ôú Rook</button>
                <button class="piece-btn" onclick="selectPiece('knight')">‚ôû Knight</button>
                <button class="piece-btn" onclick="selectPiece('bishop')">‚ôù Bishop</button>
                <button class="piece-btn" onclick="selectPiece('queen')">‚ôõ Queen</button>
                <button class="piece-btn" onclick="selectPiece('king')">‚ôö King</button>
            </div>

            <h3 id="pieceTitle">‚ôüÔ∏è Pawn Movement Demo</h3>
            <p id="pieceDescription">Click anywhere on the board to place a pawn and see how it moves!</p>
            
            <div class="demo-board" id="chessBoard"></div>
            
            <div class="controls">
                <button class="control-btn" onclick="clearBoard()">üîÑ Clear Board</button>
                <button class="control-btn" onclick="testBoard()">üîß Test Board</button>
                <button class="control-btn" onclick="showSampleMoves()">‚ú® Show Sample</button>
            </div>

            <div class="debug-info">
                <strong>Debug Info:</strong>
                <div id="debugInfo">Board loading...</div>
                <div style="margin-top: 10px;">
                    <strong>Current Piece:</strong> <span id="currentPiece">Pawn ‚ôüÔ∏è</span>
                </div>
                <div style="margin-top: 5px;">
                    <strong>Clicks:</strong> <span id="clickCount">0</span>
                </div>
            </div>
        </div>

        <div class="movement-info" id="movementInfo">
            <h3>‚ôüÔ∏è Pawn Movement Rules</h3>
            <div class="movement-rules">
                <div class="rule-card">
                    <h4>üéØ Basic Movement</h4>
                    <ul>
                        <li>Moves forward one square</li>
                        <li>Can move two squares on first move</li>
                        <li>Cannot move backwards</li>
                        <li>Cannot jump over pieces</li>
                    </ul>
                </div>
                <div class="rule-card">
                    <h4>‚öîÔ∏è How It Captures</h4>
                    <ul>
                        <li>Captures diagonally forward</li>
                        <li>One square diagonally only</li>
                        <li>Cannot capture straight ahead</li>
                        <li>Special "en passant" capture</li>
                    </ul>
                </div>
                <div class="rule-card">
                    <h4>‚≠ê Special Abilities</h4>
                    <ul>
                        <li>Promotes when reaching end</li>
                        <li>Can become any piece except king</li>
                        <li>Usually promotes to queen</li>
                        <li>Most powerful transformation!</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="special-moves">
            <h2 style="text-align: center; margin-bottom: 25px;">‚ú® Special Chess Moves</h2>
            <p style="text-align: center; margin-bottom: 20px; font-size: 1.1em;">
                <strong>üëÄ Watch the demonstrations on the main board above!</strong> 
                Click any card to see the move in action, then click "Replay" to see it again.
            </p>
            <div class="special-grid">
                <div class="special-card" onclick="demonstrateSpecial('castling')">
                    <div class="emoji">üè∞</div>
                    <h3>Castling</h3>
                    <p>King and rook move together for safety! <strong>Watch on the board above!</strong></p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        King moves 2 squares, rook jumps over
                    </div>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('enpassant')">
                    <div class="emoji">üëª</div>
                    <h3>En Passant</h3>
                    <p>Pawn captures "in passing" - a sneaky capture move!</p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        Capture enemy pawn that moved 2 squares
                    </div>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('promotion')">
                    <div class="emoji">üëë</div>
                    <h3>Pawn Promotion</h3>
                    <p>Pawn becomes a queen when reaching the end!</p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        Choose any piece except king
                    </div>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('check')">
                    <div class="emoji">‚ö†Ô∏è</div>
                    <h3>Check</h3>
                    <p>When the king is under attack and must move!</p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        King must escape immediately
                    </div>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('checkmate')">
                    <div class="emoji">üèÜ</div>
                    <h3>Checkmate</h3>
                    <p>King is trapped with no escape - game over!</p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        No legal moves to escape check
                    </div>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('stalemate')">
                    <div class="emoji">ü§ù</div>
                    <h3>Stalemate</h3>
                    <p>No legal moves available but king not in check - it's a draw!</p>
                    <div style="font-size: 0.9em; margin-top: 10px; color: rgba(255,255,255,0.8);">
                        Game ends in a tie
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="control-btn" onclick="replayLastSpecial()">üîÑ Replay Last Move</button>
                <button class="control-btn" onclick="clearBoard()">‚ú® Clear Board</button>
            </div>
        </div>

        <div class="quiz-section">
            <h2 style="text-align: center; margin-bottom: 25px;">üß† Movement Mastery Quiz!</h2>
            
            <!-- Question 1 -->
            <div class="quiz-question-container">
                <h3>‚ùì Which piece can jump over other pieces?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'correct')">
                        <span class="option-letter">A)</span> The Knight ‚ôû
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">B)</span> The Queen ‚ôõ
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">C)</span> The Rook ‚ôú
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">D)</span> The Bishop ‚ôù
                    </div>
                </div>
                <div class="quiz-result" id="result1"></div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-question-container">
                <h3>‚ùì How does a pawn capture enemy pieces?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">A)</span> Straight forward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'correct')">
                        <span class="option-letter">B)</span> Diagonally forward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">C)</span> Sideways
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">D)</span> Backwards
                    </div>
                </div>
                <div class="quiz-result" id="result2"></div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-question-container">
                <h3>‚ùì What special move involves both the king and a rook?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">A)</span> En passant
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'correct')">
                        <span class="option-letter">B)</span> Castling
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">C)</span> Promotion
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">D)</span> Check
                    </div>
                </div>
                <div class="quiz-result" id="result3"></div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-question-container">
                <h3>‚ùì Which piece moves only diagonally?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">A)</span> The Rook ‚ôú
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'correct')">
                        <span class="option-letter">B)</span> The Bishop ‚ôù
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">C)</span> The Queen ‚ôõ
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">D)</span> The Knight ‚ôû
                    </div>
                </div>
                <div class="quiz-result" id="result4"></div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-question-container">
                <h3>‚ùì How many squares can a king move at one time?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'correct')">
                        <span class="option-letter">A)</span> One square
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">B)</span> Two squares
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">C)</span> Any number of squares
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">D)</span> Three squares
                    </div>
                </div>
                <div class="quiz-result" id="result5"></div>
            </div>

            <!-- Question 6 -->
            <div class="quiz-question-container">
                <h3>‚ùì What happens when a pawn reaches the opposite end of the board?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">A)</span> It gets removed from the board
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'correct')">
                        <span class="option-letter">B)</span> It promotes to another piece
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">C)</span> It moves backward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">D)</span> It stays a pawn
                    </div>
                </div>
                <div class="quiz-result" id="result6"></div>
            </div>
        </div>

        <div class="celebration" id="celebration"></div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="completeMoves()" class="back-btn" style="font-size: 1.2em; padding: 20px 35px;">
                ‚úÖ I've Mastered All Movements!
            </button>
        </div>
    </div>

    <script>
        let currentSelectedPiece = 'pawn';
        let boardSquares = [];
        let piecePosition = null;
        let clickCounter = 0;
        let specialMovesLearned = new Set();
        let quizAnswered = new Set();
        let movesLearned = new Set(['pawn']);
        let lastSpecialMove = null;

        const pieces = {
            pawn: { 
                symbol: '‚ôü', 
                name: 'Pawn',
                rules: {
                    basic: ['Moves forward one square', 'Can move two squares on first move', 'Cannot move backwards', 'Cannot jump over pieces'],
                    capture: ['Captures diagonally forward', 'One square diagonally only', 'Cannot capture straight ahead', 'Special "en passant" capture'],
                    special: ['Promotes when reaching end', 'Can become any piece except king', 'Usually promotes to queen', 'Most powerful transformation!']
                }
            },
            rook: { 
                symbol: '‚ôú', 
                name: 'Rook',
                rules: {
                    basic: ['Moves horizontally any distance', 'Moves vertically any distance', 'Cannot move diagonally', 'Cannot jump over pieces'],
                    capture: ['Captures any piece in its path', 'Stops at the captured piece', 'Great for controlling files and ranks', 'Powerful in endgames'],
                    special: ['Can castle with the king', 'Loves open files and ranks', 'Strongest on 7th rank', 'Perfect for back rank attacks']
                }
            },
            knight: { 
                symbol: '‚ôû', 
                name: 'Knight',
                rules: {
                    basic: ['Moves in an "L" shape', '2 squares + 1 square perpendicular', 'Only piece that can jump', 'Always lands on opposite color'],
                    capture: ['Captures piece on landing square', 'Cannot be blocked by other pieces', 'Great for surprise attacks', 'Excellent piece for forks'],
                    special: ['Always changes square color', 'Can reach any square eventually', 'Strongest in closed positions', 'Knight vs bishop depends on position']
                }
            },
            bishop: { 
                symbol: '‚ôù', 
                name: 'Bishop',
                rules: {
                    basic: ['Moves diagonally any distance', 'Always stays on same color', 'Cannot jump over pieces', 'Each player starts with 2 bishops'],
                    capture: ['Captures along diagonal paths', 'Stops at captured piece', 'Can attack from long distance', 'Great for controlling diagonals'],
                    special: ['One light-square, one dark-square', 'Bishop pair is very strong', 'Stronger in open positions', 'Can control long diagonals']
                }
            },
            queen: { 
                symbol: '‚ôõ', 
                name: 'Queen',
                rules: {
                    basic: ['Combines rook and bishop moves', 'Any direction, any distance', 'Most powerful piece', 'Cannot jump over pieces'],
                    capture: ['Can capture in any direction', 'Extremely dangerous in attack', 'Can control many squares', 'Often targets of attack'],
                    special: ['Worth about 9 points', 'Keep safe in opening', 'Devastating in middlegame', 'Can checkmate with king alone']
                }
            },
            king: { 
                symbol: '‚ôö', 
                name: 'King',
                rules: {
                    basic: ['Moves one square any direction', 'Cannot move into check', 'Most important piece', 'Must be protected always'],
                    capture: ['Can capture adjacent pieces', 'Cannot capture defended pieces', 'Rarely captures in opening', 'More active in endgame'],
                    special: ['Can castle for safety', 'Cannot castle through check', 'Central in endgames', 'Never leaves the board']
                }
            }
        };

        function goBack() {
            window.history.back();
        }

        function updateDebugInfo(message) {
            const debugElement = document.getElementById('debugInfo');
            if (debugElement) {
                debugElement.textContent = message;
            }
            console.log('Debug:', message);
        }

        function createBoard() {
            const board = document.getElementById('chessBoard');
            if (!board) {
                updateDebugInfo('ERROR: Could not find board element');
                return;
            }
            
            board.innerHTML = '';
            boardSquares = [];
            
            let squareCount = 0;
            
            for (let row = 7; row >= 0; row--) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `demo-square ${(row + col) % 2 === 0 ? 'black' : 'white'}`;
                    
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.dataset.square = String.fromCharCode(97 + col) + (row + 1);
                    
                    square.onclick = function() {
                        clickOnSquare(square);
                    };
                    
                    square.title = square.dataset.square;
                    
                    board.appendChild(square);
                    boardSquares.push(square);
                    squareCount++;
                }
            }
            
            updateDebugInfo(`Board created with ${squareCount} squares`);
        }

        function clickOnSquare(square) {
            clickCounter++;
            const clickElement = document.getElementById('clickCount');
            if (clickElement) {
                clickElement.textContent = clickCounter;
            }
            
            const squareName = square.dataset.square;
            const row = parseInt(square.dataset.row);
            const col = parseInt(square.dataset.col);
            
            updateDebugInfo(`Clicked ${squareName} (row ${row}, col ${col})`);
            
            clearBoard();
            placePiece(square);
            showPossibleMoves(row, col);
            
            showMessage(`${pieces[currentSelectedPiece].symbol} placed on ${squareName}!`);
        }

        function placePiece(square) {
            const piece = pieces[currentSelectedPiece];
            square.innerHTML = `<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">${piece.symbol}</span>`;
            square.classList.add('piece-here');
            piecePosition = square;
        }

        function showPossibleMoves(row, col) {
            const moves = calculateMoves(currentSelectedPiece, row, col);
            
            moves.forEach(move => {
                const targetSquare = boardSquares.find(sq => 
                    parseInt(sq.dataset.row) === move.row && 
                    parseInt(sq.dataset.col) === move.col
                );
                
                if (targetSquare) {
                    if (move.type === 'capture') {
                        targetSquare.classList.add('can-capture');
                        targetSquare.innerHTML = '<span style="color: white; font-weight: bold;">√ó</span>';
                    } else {
                        targetSquare.classList.add('can-move');
                        targetSquare.innerHTML = '<span style="color: #333; font-weight: bold;">‚Ä¢</span>';
                    }
                }
            });
            
            updateDebugInfo(`Showing ${moves.length} possible moves for ${pieces[currentSelectedPiece].name}`);
        }

        function calculateMoves(piece, row, col) {
            const moves = [];
            
            switch(piece) {
                case 'pawn':
                    if (row < 7) {
                        moves.push({row: row + 1, col: col, type: 'move'});
                        if (row === 1) {
                            moves.push({row: row + 2, col: col, type: 'move'});
                        }
                    }
                    if (row < 7 && col > 0) moves.push({row: row + 1, col: col - 1, type: 'capture'});
                    if (row < 7 && col < 7) moves.push({row: row + 1, col: col + 1, type: 'capture'});
                    break;
                    
                case 'rook':
                    for (let i = 0; i < 8; i++) {
                        if (i !== col) moves.push({row: row, col: i, type: 'move'});
                        if (i !== row) moves.push({row: i, col: col, type: 'move'});
                    }
                    break;
                    
                case 'knight':
                    const knightMoves = [
                        [-2, -1], [-2, 1], [-1, -2], [-1, 2],
                        [1, -2], [1, 2], [2, -1], [2, 1]
                    ];
                    knightMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'move'});
                        }
                    });
                    break;
                    
                case 'bishop':
                    const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
                    directions.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'move'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'queen':
                    const allDirections = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    allDirections.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'move'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'king':
                    const kingMoves = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    kingMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'move'});
                        }
                    });
                    break;
            }
            
            return moves;
        }

        function selectPiece(piece) {
            currentSelectedPiece = piece;
            movesLearned.add(piece);
            
            document.querySelectorAll('.piece-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const pieceData = pieces[piece];
            const titleElement = document.getElementById('pieceTitle');
            const descElement = document.getElementById('pieceDescription');
            const currentElement = document.getElementById('currentPiece');
            
            if (titleElement) titleElement.textContent = `${pieceData.symbol} ${pieceData.name} Movement Demo`;
            if (descElement) descElement.textContent = `Click anywhere on the board to place a ${pieceData.name.toLowerCase()} and see how it moves!`;
            if (currentElement) currentElement.textContent = `${pieceData.name} ${pieceData.symbol}`;
            
            updateMovementInfo(piece);
            clearBoard();
            updateDebugInfo(`Selected ${pieceData.name}. Click any square to place it.`);
            showMessage(`üéØ Now practicing ${pieceData.symbol} ${pieceData.name} movements!`);
        }

        function demonstrateSpecial(specialMove) {
            specialMovesLearned.add(specialMove);
            lastSpecialMove = specialMove;
            if (event && event.target) {
                event.target.classList.add('learned');
            }
            
            clearBoard();
            
            const explanations = {
                castling: "üè∞ Castling: Look at the main board above! King moves 2 squares toward rook, rook jumps to other side.",
                enpassant: "üëª En Passant: Watch the board! White pawn captures black pawn 'in passing' - special pawn rule!",
                promotion: "üëë Promotion: See the transformation! Pawn reaches the end and becomes a powerful queen!",
                check: "‚ö†Ô∏è Check: Look at the board! Queen attacks king - king must move to safety immediately!",
                checkmate: "üèÜ Checkmate: Watch the board! King is trapped with no escape moves - game over!",
                stalemate: "ü§ù Stalemate: See the board! King has no legal moves but isn't in check - it's a draw!"
            };
            
            showMessage(explanations[specialMove]);
            
            // Scroll to board to make sure user sees it
            document.getElementById('chessBoard').scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Set up demonstration position
            setTimeout(() => {
                switch(specialMove) {
                    case 'castling':
                        showMessage('üëÄ Watch the main board: King and rook will move together!');
                        const kingSquare = boardSquares.find(sq => sq.dataset.square === 'e1');
                        const rookSquare = boardSquares.find(sq => sq.dataset.square === 'h1');
                        if (kingSquare && rookSquare) {
                            kingSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôö</span>';
                            kingSquare.classList.add('piece-here');
                            rookSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôú</span>';
                            rookSquare.classList.add('piece-here');
                            
                            setTimeout(() => {
                                showMessage('üè∞ Now they move together! King to g1, rook to f1!');
                                kingSquare.innerHTML = '';
                                rookSquare.innerHTML = '';
                                kingSquare.classList.remove('piece-here');
                                rookSquare.classList.remove('piece-here');
                                
                                const newKing = boardSquares.find(sq => sq.dataset.square === 'g1');
                                const newRook = boardSquares.find(sq => sq.dataset.square === 'f1');
                                if (newKing && newRook) {
                                    newKing.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôö</span>';
                                    newKing.classList.add('can-move');
                                    newRook.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôú</span>';
                                    newRook.classList.add('can-move');
                                    showMessage('üè∞ Castling complete! Both pieces moved in one turn for king safety!');
                                }
                            }, 2000);
                        }
                        break;
                        
                    case 'enpassant':
                        showMessage('üëÄ Watch the board: White pawn will capture black pawn "in passing"!');
                        const whitePawn = boardSquares.find(sq => sq.dataset.square === 'd5');
                        const blackPawn = boardSquares.find(sq => sq.dataset.square === 'e5');
                        if (whitePawn && blackPawn) {
                            whitePawn.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôü</span>';
                            whitePawn.classList.add('piece-here');
                            blackPawn.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #e74c3c;">‚ôü</span>';
                            blackPawn.classList.add('can-capture');
                            
                            setTimeout(() => {
                                showMessage('üëª En passant capture! White pawn takes black pawn and moves diagonally!');
                                whitePawn.innerHTML = '';
                                blackPawn.innerHTML = '';
                                whitePawn.classList.remove('piece-here');
                                blackPawn.classList.remove('can-capture');
                                
                                const captureSquare = boardSquares.find(sq => sq.dataset.square === 'e6');
                                if (captureSquare) {
                                    captureSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôü</span>';
                                    captureSquare.classList.add('can-move');
                                    showMessage('üëª Special capture complete! Black pawn captured "in passing"!');
                                }
                            }, 2000);
                        }
                        break;
                        
                    case 'promotion':
                        showMessage('üëÄ Watch the board: Pawn will reach the end and transform!');
                        const pawnSquare = boardSquares.find(sq => sq.dataset.square === 'e7');
                        if (pawnSquare) {
                            pawnSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôü</span>';
                            pawnSquare.classList.add('piece-here');
                            
                            setTimeout(() => {
                                showMessage('üëë Pawn reaches the end and becomes a queen! Most powerful transformation!');
                                pawnSquare.innerHTML = '';
                                pawnSquare.classList.remove('piece-here');
                                const promoteSquare = boardSquares.find(sq => sq.dataset.square === 'e8');
                                if (promoteSquare) {
                                    promoteSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôõ</span>';
                                    promoteSquare.classList.add('can-move');
                                    showMessage('üëë Promotion complete! Weak pawn became mighty queen!');
                                }
                            }, 2000);
                        }
                        break;
                        
                    case 'check':
                        showMessage('üëÄ Watch the board: Queen will attack the king!');
                        const king = boardSquares.find(sq => sq.dataset.square === 'e1');
                        const attackingQueen = boardSquares.find(sq => sq.dataset.square === 'e8');
                        if (king && attackingQueen) {
                            king.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôö</span>';
                            king.classList.add('can-capture');
                            attackingQueen.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #e74c3c;">‚ôõ</span>';
                            attackingQueen.classList.add('piece-here');
                            
                            setTimeout(() => {
                                // Highlight attack path
                                const pathSquares = ['e2', 'e3', 'e4', 'e5', 'e6', 'e7'];
                                pathSquares.forEach(square => {
                                    const sq = boardSquares.find(s => s.dataset.square === square);
                                    if (sq) {
                                        sq.classList.add('can-capture');
                                    }
                                });
                                showMessage('‚ö†Ô∏è CHECK! Red queen attacks white king! King must move to safety NOW!');
                            }, 1500);
                        }
                        break;
                        
                    case 'checkmate':
                        showMessage('üëÄ Watch the board: King will be trapped with no escape!');
                        const checkmateKing = boardSquares.find(sq => sq.dataset.square === 'h8');
                        const checkmateQueen = boardSquares.find(sq => sq.dataset.square === 'g6');
                        const checkmateRook = boardSquares.find(sq => sq.dataset.square === 'h1');
                        if (checkmateKing && checkmateQueen && checkmateRook) {
                            checkmateKing.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôö</span>';
                            checkmateKing.classList.add('can-capture');
                            checkmateQueen.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #e74c3c;">‚ôõ</span>';
                            checkmateQueen.classList.add('piece-here');
                            checkmateRook.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #e74c3c;">‚ôú</span>';
                            checkmateRook.classList.add('piece-here');
                            
                            setTimeout(() => {
                                // Show all escape squares are blocked
                                const blockedSquares = ['g8', 'g7', 'h7'];
                                blockedSquares.forEach(square => {
                                    const sq = boardSquares.find(s => s.dataset.square === square);
                                    if (sq) {
                                        sq.classList.add('can-capture');
                                        sq.innerHTML = '<span style="color: white; font-weight: bold;">‚úï</span>';
                                    }
                                });
                                showMessage('üèÜ CHECKMATE! King has no escape moves - game over! You win!');
                            }, 1500);
                        }
                        break;
                        
                    case 'stalemate':
                        showMessage('üëÄ Watch the board: King has no moves but is not in check!');
                        const stalemateKing = boardSquares.find(sq => sq.dataset.square === 'a8');
                        const stalemateQueen = boardSquares.find(sq => sq.dataset.square === 'c6');
                        if (stalemateKing && stalemateQueen) {
                            stalemateKing.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôö</span>';
                            stalemateKing.classList.add('piece-here');
                            stalemateQueen.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #e74c3c;">‚ôõ</span>';
                            stalemateQueen.classList.add('piece-here');
                            
                            setTimeout(() => {
                                // Show no legal moves available
                                const noMoveSquares = ['a7', 'b8', 'b7'];
                                noMoveSquares.forEach(square => {
                                    const sq = boardSquares.find(s => s.dataset.square === square);
                                    if (sq) {
                                        sq.classList.add('can-capture');
                                        sq.innerHTML = '<span style="color: white; font-weight: bold;">‚úï</span>';
                                    }
                                });
                                showMessage('ü§ù STALEMATE! King not in check but no legal moves - it\'s a draw!');
                            }, 1500);
                        }
                        break;
                }
            }, 1000);
        }

        function replayLastSpecial() {
            if (lastSpecialMove) {
                showMessage(`üîÑ Replaying ${lastSpecialMove}...`);
                setTimeout(() => {
                    demonstrateSpecial(lastSpecialMove);
                }, 500);
            } else {
                showMessage('üîÑ Click a special move first, then you can replay it!');
            }
        }

        function selectQuizAnswer(option, questionNumber, correctness) {
            const questionContainer = option.closest('.quiz-question-container');
            const allOptions = questionContainer.querySelectorAll('.quiz-option');
            const resultDiv = document.getElementById(`result${questionNumber}`);
            
            if (option.classList.contains('disabled')) {
                return;
            }
            
            quizAnswered.add(`question-${questionNumber}`);
            
            allOptions.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.onclick.toString().includes('correct')) {
                    opt.classList.add('correct');
                } else if (opt === option && correctness === 'incorrect') {
                    opt.classList.add('incorrect');
                }
            });
            
            if (correctness === 'correct') {
                resultDiv.textContent = '‚úÖ Excellent! That\'s the correct answer!';
                resultDiv.className = 'quiz-result correct show';
                showMessage('üéâ Correct answer! You\'re mastering chess movements!');
            } else {
                resultDiv.textContent = '‚ùå Not quite right. The correct answer is highlighted in green above.';
                resultDiv.className = 'quiz-result incorrect show';
                showMessage('üìö Keep learning! The correct answer is now highlighted.');
            }
        }

        function completeMoves() {
            const totalItems = 6 + 6 + 6; // pieces + specials + quiz questions
            const completedItems = movesLearned.size + specialMovesLearned.size + quizAnswered.size;
            
            if (completedItems >= totalItems * 0.7) {
                showMessage('üèÜ Incredible! You\'ve mastered chess movements!');
                
                setTimeout(() => {
                    if (confirm('üß† Ready for the ultimate chess quiz? Click OK to test everything you\'ve learned!')) {
                        window.location.href = 'quiz.html';
                    }
                }, 2000);
            } else {
                showMessage(`üéØ Complete more activities! You have ${completedItems}/${totalItems} done. Try more pieces, special moves, and quiz questions!`);
            }
        }

        function updateMovementInfo(piece) {
            const info = document.getElementById('movementInfo');
            const pieceData = pieces[piece];
            
            if (info && pieceData) {
                info.innerHTML = `
                    <h3>${pieceData.symbol} ${pieceData.name} Movement Rules</h3>
                    <div class="movement-rules">
                        <div class="rule-card">
                            <h4>üéØ Basic Movement</h4>
                            <ul>
                                ${pieceData.rules.basic.map(rule => `<li>${rule}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="rule-card">
                            <h4>‚öîÔ∏è How It Captures</h4>
                            <ul>
                                ${pieceData.rules.capture.map(rule => `<li>${rule}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="rule-card">
                            <h4>‚≠ê Special Abilities</h4>
                            <ul>
                                ${pieceData.rules.special.map(rule => `<li>${rule}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        function clearBoard() {
            boardSquares.forEach(square => {
                square.innerHTML = '';
                square.classList.remove('piece-here', 'can-move', 'can-capture');
            });
            piecePosition = null;
            updateDebugInfo('Board cleared');
        }

        function testBoard() {
            clearBoard();
            
            const testSquare = boardSquares.find(sq => sq.dataset.square === 'e4');
            if (testSquare) {
                testSquare.innerHTML = '<span style="font-size: clamp(1.2rem, 4vw, 2rem); color: #2d3436;">‚ôü</span>';
                testSquare.classList.add('piece-here');
                
                const testSquares = ['e5', 'd5', 'f5'];
                testSquares.forEach(squareName => {
                    const sq = boardSquares.find(s => s.dataset.square === squareName);
                    if (sq) {
                        sq.classList.add('can-move');
                        sq.innerHTML = '<span style="color: #333; font-weight: bold;">‚Ä¢</span>';
                    }
                });
                
                updateDebugInfo('Test: Placed pawn on e4 with sample moves');
                showMessage('üîß Test successful! Board is working correctly.');
            } else {
                updateDebugInfo('ERROR: Could not find e4 square');
            }
        }

        function showSampleMoves() {
            clearBoard();
            
            const piece = pieces[currentSelectedPiece];
            const centerSquare = boardSquares.find(sq => sq.dataset.square === 'e4');
            
            if (centerSquare) {
                clickOnSquare(centerSquare);
                showMessage(`‚ú® Sample ${piece.name} moves from center of board!`);
            }
        }

        function showMessage(message) {
            const celebration = document.getElementById('celebration');
            if (celebration) {
                celebration.textContent = message;
                celebration.classList.add('show');
                
                setTimeout(() => {
                    celebration.classList.remove('show');
                }, 3000);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo('Page loaded, creating board...');
            createBoard();
            selectPiece('pawn');
            showMessage('üöÄ Welcome! Click any square to place a piece and see its moves!');
        });
    </script>
</body>
</html>