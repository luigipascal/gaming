<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ How Chess Pieces Move - Master Every Movement!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3em;
            color: #4a5568;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .progress-tracker {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: center;
        }

        .progress-bar {
            background: #e9ecef;
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            border-radius: 12px;
            transition: width 0.8s ease;
            width: 0%;
        }

        .movement-selector {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .piece-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .piece-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            border: none;
            padding: 15px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            min-width: 120px;
            position: relative;
        }

        .piece-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .piece-btn.active {
            background: linear-gradient(45deg, #e17055, #fdcb6e);
            transform: scale(1.05);
        }

        .piece-btn.completed::after {
            content: "‚úÖ";
            position: absolute;
            top: -5px;
            right: -5px;
            background: #28a745;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .demo-board-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .demo-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 2px;
            margin: 20px auto;
            background: #8b4513;
            padding: 10px;
            border-radius: 10px;
            justify-content: center;
            border: 3px solid #333;
        }

        .demo-square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            position: relative;
            border: 1px solid #999;
        }

        .demo-square.white {
            background: #f0d9b5;
        }

        .demo-square.black {
            background: #b58863;
        }

        .demo-square.piece-position {
            background: #4caf50 !important;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px #4caf50;
            border: 3px solid #2e7d32;
        }

        .demo-square.valid-move {
            background: #ffeb3b !important;
            box-shadow: 0 0 15px #ffeb3b;
            border: 2px solid #f57f17;
        }

        .demo-square.capture-move {
            background: #ff5722 !important;
            box-shadow: 0 0 15px #ff5722;
            border: 2px solid #d84315;
        }

        .demo-square.special-move {
            background: #9c27b0 !important;
            box-shadow: 0 0 15px #9c27b0;
            border: 2px solid #6a1b9a;
        }

        .demo-square.enemy {
            background: #e74c3c !important;
            color: white;
            border: 2px solid #c0392b;
        }

        .demo-square:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #e91e63, #f06292);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .movement-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .movement-info h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .movement-rules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .rule-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .rule-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .rule-card ul {
            list-style: none;
            padding: 0;
        }

        .rule-card li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .rule-card li:before {
            content: "‚≠ê";
            position: absolute;
            left: 0;
        }

        .special-moves {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .special-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .special-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .special-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .special-card.learned::after {
            content: "‚úÖ";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .special-card .emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .challenge-section {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .challenge-card.completed::after {
            content: "üèÜ";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffd700;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .challenge-board {
            display: grid;
            grid-template-columns: repeat(8, 45px);
            grid-template-rows: repeat(8, 45px);
            gap: 1px;
            margin: 20px auto;
            background: #8b4513;
            padding: 10px;
            border-radius: 10px;
            justify-content: center;
        }

        .challenge-square {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .challenge-square.white {
            background: #f0d9b5;
        }

        .challenge-square.black {
            background: #b58863;
        }

        .hint-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .quiz-question-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .quiz-question-container h3 {
            color: white;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-weight: bold;
            border: 2px solid transparent;
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .quiz-option.correct {
            background: #d4edda !important;
            border: 2px solid #28a745 !important;
            color: #155724;
        }

        .quiz-option.incorrect {
            background: #f8d7da !important;
            border: 2px solid #dc3545 !important;
            color: #721c24;
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .option-letter {
            background: #74b9ff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 14px;
            font-weight: bold;
        }

        .quiz-option.correct .option-letter {
            background: #28a745;
        }

        .quiz-option.incorrect .option-letter {
            background: #dc3545;
        }

        .quiz-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .quiz-result.show {
            opacity: 1;
        }

        .quiz-result.correct {
            background: rgba(40, 167, 69, 0.2);
            color: #d4edda;
            border: 1px solid #28a745;
        }

        .quiz-result.incorrect {
            background: rgba(220, 53, 69, 0.2);
            color: #f8d7da;
            border: 1px solid #dc3545;
        }

        .celebration {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .celebration.show {
            opacity: 1;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .demo-board {
                grid-template-columns: repeat(8, 45px);
                grid-template-rows: repeat(8, 45px);
            }
            
            .demo-square {
                width: 45px;
                height: 45px;
                font-size: 24px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="goBack()">‚¨ÖÔ∏è Back to Chess Kingdom</button>
        
        <div class="header">
            <h1>üöÄ Master Chess Piece Movements!</h1>
            <p style="font-size: 1.2em; color: #666;">Learn how each piece moves and become a movement master!</p>
        </div>

        <div class="progress-tracker">
            <h3>üéñÔ∏è Your Movement Learning Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Movement Mastery: 0%</p>
        </div>

        <div class="movement-selector">
            <h2>üéØ Choose a Piece to Practice</h2>
            <div class="piece-buttons">
                <button class="piece-btn active" onclick="selectPiece('pawn', this)">‚ôüÔ∏è Pawn</button>
                <button class="piece-btn" onclick="selectPiece('rook', this)">‚ôú Rook</button>
                <button class="piece-btn" onclick="selectPiece('knight', this)">‚ôû Knight</button>
                <button class="piece-btn" onclick="selectPiece('bishop', this)">‚ôù Bishop</button>
                <button class="piece-btn" onclick="selectPiece('queen', this)">‚ôõ Queen</button>
                <button class="piece-btn" onclick="selectPiece('king', this)">‚ôö King</button>
            </div>
        </div>

        <div class="demo-board-container">
            <h3 id="currentPieceTitle">‚ôüÔ∏è Pawn Movement Demo</h3>
            <p id="currentPieceDescription">Click anywhere on the board to place a pawn and see how it moves!</p>
            
            <div class="demo-board" id="demoBoard">
                <!-- Board will be generated by JavaScript -->
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="clearBoard()">üîÑ Clear Board</button>
                <button class="control-btn" onclick="randomPosition()">üé≤ Random Position</button>
                <button class="control-btn" onclick="showCaptures()">‚öîÔ∏è Show Captures</button>
                <button class="control-btn" onclick="animateMovement()">üé¨ Animate Move</button>
                <button class="control-btn" onclick="testBoard()">üîß Test Board</button>
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; font-family: monospace;">
                <strong>Board Status:</strong>
                <div id="boardStatus">Click on the board to see information here...</div>
                <div style="margin-top: 10px;">
                    <strong>Current Piece:</strong> <span id="currentPieceDisplay">‚ôüÔ∏è Pawn</span>
                </div>
                <div style="margin-top: 5px;">
                    <strong>Piece Position:</strong> <span id="piecePositionDisplay">None placed</span>
                </div>
                <div style="margin-top: 5px;">
                    <strong>Valid Moves:</strong> <span id="validMovesDisplay">0</span>
                </div>
            </div>
        </div>

        <div class="movement-info" id="movementInfo">
            <!-- Movement rules will be populated by JavaScript -->
        </div>

        <div class="special-moves">
            <h2 style="text-align: center; margin-bottom: 25px;">‚ú® Special Chess Moves</h2>
            <div class="special-grid">
                <div class="special-card" onclick="demonstrateSpecial('castling')">
                    <div class="emoji">üè∞</div>
                    <h3>Castling</h3>
                    <p>King and rook move together for safety! Click to see it in action.</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('enpassant')">
                    <div class="emoji">üëª</div>
                    <h3>En Passant</h3>
                    <p>Pawn captures "in passing" - a sneaky capture move!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('promotion')">
                    <div class="emoji">üëë</div>
                    <h3>Pawn Promotion</h3>
                    <p>Pawn becomes a queen when reaching the end!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('check')">
                    <div class="emoji">‚ö†Ô∏è</div>
                    <h3>Check</h3>
                    <p>When the king is under attack and must move!</p>
                </div>
            </div>
        </div>

        <div class="challenge-section">
            <h2 style="text-align: center; margin-bottom: 25px;">üéÆ Interactive Movement Challenges</h2>
            <div class="challenge-grid">
                <div class="challenge-card" onclick="startChallenge('pawn-race')">
                    <h3>üèÉ‚Äç‚ôÇÔ∏è Pawn Race</h3>
                    <p>Get your pawn to the other end of the board!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê Difficulty: Easy</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('knight-moves')">
                    <h3>üêé Knight Training</h3>
                    <p>Learn the knight's L-shaped moves step by step!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê Difficulty: Medium</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('rook-path')">
                    <h3>üè∞ Rook Highway</h3>
                    <p>Find the shortest path for the rook to reach its target!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê Difficulty: Easy</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('bishop-diagonal')">
                    <h3>‚ö° Bishop Journey</h3>
                    <p>Move the bishop along diagonals to capture the target!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê Difficulty: Medium</div>
                </div>
            </div>
        </div>

        <div class="quiz-section">
            <h2 style="text-align: center; margin-bottom: 25px;">üß† Movement Mastery Quiz!</h2>
            
            <!-- Question 1 -->
            <div class="quiz-question-container">
                <h3>‚ùì Which piece can jump over other pieces?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'correct')">
                        <span class="option-letter">A)</span> The Knight ‚ôû
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">B)</span> The Queen ‚ôõ
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">C)</span> The Rook ‚ôú
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 1, 'incorrect')">
                        <span class="option-letter">D)</span> The Bishop ‚ôù
                    </div>
                </div>
                <div class="quiz-result" id="result1"></div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-question-container">
                <h3>‚ùì How does a pawn capture enemy pieces?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">A)</span> Straight forward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'correct')">
                        <span class="option-letter">B)</span> Diagonally forward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">C)</span> Sideways
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 2, 'incorrect')">
                        <span class="option-letter">D)</span> Backwards
                    </div>
                </div>
                <div class="quiz-result" id="result2"></div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-question-container">
                <h3>‚ùì Which piece moves only diagonally?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">A)</span> The Rook ‚ôú
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'correct')">
                        <span class="option-letter">B)</span> The Bishop ‚ôù
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">C)</span> The Queen ‚ôõ
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 3, 'incorrect')">
                        <span class="option-letter">D)</span> The Knight ‚ôû
                    </div>
                </div>
                <div class="quiz-result" id="result3"></div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-question-container">
                <h3>‚ùì What special move involves both the king and a rook?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">A)</span> En passant
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'correct')">
                        <span class="option-letter">B)</span> Castling
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">C)</span> Promotion
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 4, 'incorrect')">
                        <span class="option-letter">D)</span> Check
                    </div>
                </div>
                <div class="quiz-result" id="result4"></div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-question-container">
                <h3>‚ùì How many squares can a king move at one time?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'correct')">
                        <span class="option-letter">A)</span> One square
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">B)</span> Two squares
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">C)</span> Any number of squares
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 5, 'incorrect')">
                        <span class="option-letter">D)</span> Three squares
                    </div>
                </div>
                <div class="quiz-result" id="result5"></div>
            </div>

            <!-- Question 6 -->
            <div class="quiz-question-container">
                <h3>‚ùì What happens when a pawn reaches the opposite end of the board?</h3>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">A)</span> It gets removed from the board
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'correct')">
                        <span class="option-letter">B)</span> It promotes to another piece
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">C)</span> It moves backward
                    </div>
                    <div class="quiz-option" onclick="selectQuizAnswer(this, 6, 'incorrect')">
                        <span class="option-letter">D)</span> It stays a pawn
                    </div>
                </div>
                <div class="quiz-result" id="result6"></div>
            </div>
        </div>

        <div class="celebration" id="celebration"></div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="completeMoves()" class="back-btn" style="font-size: 1.2em; padding: 20px 35px;">
                ‚úÖ I've Mastered All Movements!
            </button>
        </div>
    </div>

    <!-- Modal for challenges -->
    <div id="challengeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Challenge</h2>
            <p id="modalDescription">Challenge description</p>
            <div id="modalBoard" class="challenge-board"></div>
            <div id="hintBox" class="hint-box"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="control-btn" onclick="getHint()">üí° Get Hint</button>
                <button class="control-btn" onclick="resetChallenge()">üîÑ Reset</button>
                <button class="control-btn" onclick="closeModal()">‚úÖ Complete</button>
            </div>
        </div>
    </div>

    <script>
        let currentPiece = 'pawn';
        let piecePosition = null;
        let movesLearned = new Set(['pawn']); // Start with pawn
        let specialMovesLearned = new Set();
        let challengesCompleted = new Set();
        let quizAnswered = new Set();
        let currentChallenge = null;
        let challengeData = {};

        const pieceMovements = {
            pawn: {
                title: '‚ôüÔ∏è Pawn Movement Demo',
                description: 'Click anywhere on the board to place a pawn and see how it moves!',
                emoji: '‚ôüÔ∏è',
                symbol: '‚ôü',
                rules: {
                    basic: ['Moves forward one square', 'Can move two squares on first move', 'Cannot move backwards', 'Cannot jump over pieces'],
                    capture: ['Captures diagonally forward', 'One square diagonally only', 'Cannot capture straight ahead', 'Special "en passant" capture'],
                    special: ['Promotes when reaching end', 'Can become any piece except king', 'Usually promotes to queen', 'Most powerful transformation!']
                }
            },
            rook: {
                title: '‚ôú Rook Movement Demo',
                description: 'Click to place a rook and see its powerful straight-line movement!',
                emoji: '‚ôú',
                symbol: '‚ôú',
                rules: {
                    basic: ['Moves horizontally any distance', 'Moves vertically any distance', 'Cannot move diagonally', 'Cannot jump over pieces'],
                    capture: ['Captures any piece in its path', 'Stops at the captured piece', 'Great for controlling files and ranks', 'Powerful in endgames'],
                    special: ['Can castle with the king', 'Loves open files and ranks', 'Strongest on 7th rank', 'Perfect for back rank attacks']
                }
            },
            knight: {
                title: '‚ôû Knight Movement Demo',
                description: 'Watch the knight hop in its unique L-shaped pattern!',
                emoji: '‚ôû',
                symbol: '‚ôû',
                rules: {
                    basic: ['Moves in an "L" shape', '2 squares + 1 square perpendicular', 'Only piece that can jump', 'Always lands on opposite color'],
                    capture: ['Captures piece on landing square', 'Cannot be blocked by other pieces', 'Great for surprise attacks', 'Excellent piece for forks'],
                    special: ['Always changes square color', 'Can reach any square eventually', 'Strongest in closed positions', 'Knight vs bishop depends on position']
                }
            },
            bishop: {
                title: '‚ôù Bishop Movement Demo',
                description: 'See how bishops glide along their diagonal paths!',
                emoji: '‚ôù',
                symbol: '‚ôù',
                rules: {
                    basic: ['Moves diagonally any distance', 'Always stays on same color', 'Cannot jump over pieces', 'Each player starts with 2 bishops'],
                    capture: ['Captures along diagonal paths', 'Stops at captured piece', 'Can attack from long distance', 'Great for controlling diagonals'],
                    special: ['One light-square, one dark-square', 'Bishop pair is very strong', 'Stronger in open positions', 'Can control long diagonals']
                }
            },
            queen: {
                title: '‚ôõ Queen Movement Demo',
                description: 'Experience the queen\'s incredible power and versatility!',
                emoji: '‚ôõ',
                symbol: '‚ôõ',
                rules: {
                    basic: ['Combines rook and bishop moves', 'Any direction, any distance', 'Most powerful piece', 'Cannot jump over pieces'],
                    capture: ['Can capture in any direction', 'Extremely dangerous in attack', 'Can control many squares', 'Often targets of attack'],
                    special: ['Worth about 9 points', 'Keep safe in opening', 'Devastating in middlegame', 'Can checkmate with king alone']
                }
            },
            king: {
                title: '‚ôö King Movement Demo',
                description: 'Learn the king\'s careful, one-square movements!',
                emoji: '‚ôö',
                symbol: '‚ôö',
                rules: {
                    basic: ['Moves one square any direction', 'Cannot move into check', 'Most important piece', 'Must be protected always'],
                    capture: ['Can capture adjacent pieces', 'Cannot capture defended pieces', 'Rarely captures in opening', 'More active in endgame'],
                    special: ['Can castle for safety', 'Cannot castle through check', 'Central in endgames', 'Never leaves the board']
                }
            }
        };

        function goBack() {
            window.history.back();
        }

        function createDemoBoard() {
            const board = document.getElementById('demoBoard');
            board.innerHTML = '';
            
            for (let row = 7; row >= 0; row--) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `demo-square ${(row + col) % 2 === 0 ? 'black' : 'white'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.dataset.square = String.fromCharCode(97 + col) + (row + 1);
                    square.onclick = () => placePiece(square);
                    board.appendChild(square);
                }
            }
        }

        function selectPiece(piece, button) {
            currentPiece = piece;
            movesLearned.add(piece);
            updateProgress();
            
            // Update button states
            document.querySelectorAll('.piece-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active', 'completed');
            
            // Update display
            const pieceData = pieceMovements[piece];
            document.getElementById('currentPieceTitle').textContent = pieceData.title;
            document.getElementById('currentPieceDescription').textContent = pieceData.description;
            
            // Update movement info
            updateMovementInfo(piece);
            
            // Clear board
            clearBoard();
            
            showCelebration(`üéØ Now practicing ${pieceData.emoji} ${piece} movements!`);
        }

        function updateMovementInfo(piece) {
            const info = document.getElementById('movementInfo');
            const pieceData = pieceMovements[piece];
            
            info.innerHTML = `
                <h3>${pieceData.emoji} ${piece.charAt(0).toUpperCase() + piece.slice(1)} Movement Rules</h3>
                <div class="movement-rules">
                    <div class="rule-card">
                        <h4>üéØ Basic Movement</h4>
                        <ul>
                            ${pieceData.rules.basic.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="rule-card">
                        <h4>‚öîÔ∏è How It Captures</h4>
                        <ul>
                            ${pieceData.rules.capture.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="rule-card">
                        <h4>‚≠ê Special Abilities</h4>
                        <ul>
                            ${pieceData.rules.special.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function placePiece(square) {
            // Clear previous piece and moves
            clearBoard();
            
            // Place piece with proper color
            const pieceData = pieceMovements[currentPiece];
            square.innerHTML = `<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">${pieceData.symbol}</span>`;
            square.classList.add('piece-position');
            piecePosition = {
                row: parseInt(square.dataset.row),
                col: parseInt(square.dataset.col),
                square: square
            };
            
            // Show valid moves
            showValidMoves();
            
            showCelebration(`${pieceData.emoji} placed on ${square.dataset.square}!`);
        }

        function showValidMoves() {
            if (!piecePosition) return;
            
            const moves = calculateMoves(currentPiece, piecePosition.row, piecePosition.col);
            
            moves.forEach(move => {
                const targetSquare = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                if (targetSquare) {
                    if (move.type === 'capture') {
                        targetSquare.classList.add('capture-move');
                        targetSquare.innerHTML = '<span style="color: white; font-weight: bold; font-size: 20px;">√ó</span>';
                    } else if (move.type === 'special') {
                        targetSquare.classList.add('special-move');
                        targetSquare.innerHTML = '<span style="color: white; font-weight: bold; font-size: 20px;">‚òÖ</span>';
                    } else {
                        targetSquare.classList.add('valid-move');
                        targetSquare.innerHTML = '<span style="color: #333; font-weight: bold; font-size: 20px;">‚Ä¢</span>';
                    }
                }
            });
        }

        function calculateMoves(piece, row, col) {
            const moves = [];
            
            switch(piece) {
                case 'pawn':
                    // Forward moves
                    if (row < 7) {
                        moves.push({row: row + 1, col: col, type: 'normal'});
                        if (row === 1) { // First move
                            moves.push({row: row + 2, col: col, type: 'special'});
                        }
                    }
                    // Captures
                    if (row < 7 && col > 0) moves.push({row: row + 1, col: col - 1, type: 'capture'});
                    if (row < 7 && col < 7) moves.push({row: row + 1, col: col + 1, type: 'capture'});
                    break;
                    
                case 'rook':
                    // Horizontal and vertical moves
                    for (let i = 0; i < 8; i++) {
                        if (i !== col) moves.push({row: row, col: i, type: 'normal'});
                        if (i !== row) moves.push({row: i, col: col, type: 'normal'});
                    }
                    break;
                    
                case 'knight':
                    const knightMoves = [
                        [-2, -1], [-2, 1], [-1, -2], [-1, 2],
                        [1, -2], [1, 2], [2, -1], [2, 1]
                    ];
                    knightMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'normal'});
                        }
                    });
                    break;
                    
                case 'bishop':
                    // Diagonal moves
                    const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
                    directions.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'normal'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'queen':
                    // Combine rook and bishop moves
                    const allDirections = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    allDirections.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'normal'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'king':
                    // One square in any direction
                    const kingMoves = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    kingMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'normal'});
                        }
                    });
                    // Castling
                    if (row === 0 && col === 4) { // King on starting square
                        moves.push({row: 0, col: 2, type: 'special'}); // Queen side
                        moves.push({row: 0, col: 6, type: 'special'}); // King side
                    }
                    break;
            }
            
            return moves;
        }

        function clearBoard() {
            document.querySelectorAll('.demo-square').forEach(square => {
                square.innerHTML = '';
                square.classList.remove('piece-position', 'valid-move', 'capture-move', 'special-move', 'enemy');
            });
            piecePosition = null;
        }

        function randomPosition() {
            const row = Math.floor(Math.random() * 8);
            const col = Math.floor(Math.random() * 8);
            const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            placePiece(square);
        }

        function showCaptures() {
            if (!piecePosition) {
                showCelebration('Place a piece first to see captures!');
                return;
            }
            
            // Add some enemy pieces randomly
            const squares = document.querySelectorAll('.demo-square');
            let enemyCount = 0;
            
            squares.forEach(square => {
                if (!square.classList.contains('piece-position') && Math.random() < 0.12 && enemyCount < 5) {
                    square.innerHTML = '<span style="color: white; text-shadow: 1px 1px 2px #000000; font-size: 28px;">‚ôõ</span>';
                    square.classList.add('enemy');
                    enemyCount++;
                }
            });
            
            showValidMoves();
            showCelebration('üó°Ô∏è Enemy pieces added! See which ones you can capture!');
        }

        function animateMovement() {
            if (!piecePosition) {
                randomPosition();
                return;
            }
            
            const moves = calculateMoves(currentPiece, piecePosition.row, piecePosition.col);
            if (moves.length === 0) return;
            
            const randomMove = moves[Math.floor(Math.random() * moves.length)];
            const targetSquare = document.querySelector(`[data-row="${randomMove.row}"][data-col="${randomMove.col}"]`);
            
            // Animate movement
            const piece = piecePosition.square;
            piece.style.transform = 'scale(1.3)';
            piece.style.zIndex = '100';
            
            setTimeout(() => {
                // Move piece
                const pieceContent = piece.innerHTML;
                piece.innerHTML = '';
                piece.classList.remove('piece-position');
                targetSquare.innerHTML = pieceContent;
                targetSquare.classList.add('piece-position');
                targetSquare.style.transform = 'scale(1.3)';
                
                piecePosition = {
                    row: randomMove.row,
                    col: randomMove.col,
                    square: targetSquare
                };
                
                setTimeout(() => {
                    piece.style.transform = '';
                    targetSquare.style.transform = '';
                    piece.style.zIndex = '';
                    clearBoard();
                    targetSquare.innerHTML = pieceContent;
                    targetSquare.classList.add('piece-position');
                    piecePosition.square = targetSquare;
                    showValidMoves();
                }, 500);
            }, 500);
            
            showCelebration('üé¨ Watch the piece move!');
        }

        function demonstrateSpecial(specialMove) {
            specialMovesLearned.add(specialMove);
            updateProgress();
            event.target.classList.add('learned');
            
            clearBoard();
            
            const explanations = {
                castling: "üè∞ Castling: King moves 2 squares toward rook, rook jumps to other side. Great for king safety!",
                enpassant: "üëª En Passant: When enemy pawn moves 2 squares, you can capture 'in passing' as if it moved 1!",
                promotion: "üëë Promotion: When pawn reaches end of board, it becomes any piece you choose (usually queen)!",
                check: "‚ö†Ô∏è Check: When king is attacked, it must move to safety immediately. Say 'Check!'"
            };
            
            showCelebration(explanations[specialMove]);
            
            // Set up demonstration position
            setTimeout(() => {
                switch(specialMove) {
                    case 'castling':
                        // White king and rook castling
                        const kingSquare = document.querySelector('[data-row="0"][data-col="4"]');
                        const rookSquare = document.querySelector('[data-row="0"][data-col="7"]');
                        const newKingPos = document.querySelector('[data-row="0"][data-col="6"]');
                        const newRookPos = document.querySelector('[data-row="0"][data-col="5"]');
                        
                        kingSquare.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôö</span>';
                        rookSquare.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôú</span>';
                        
                        setTimeout(() => {
                            kingSquare.innerHTML = '';
                            rookSquare.innerHTML = '';
                            newKingPos.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôö</span>';
                            newRookPos.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôú</span>';
                            newKingPos.classList.add('special-move');
                            newRookPos.classList.add('special-move');
                            showCelebration('üè∞ King and rook moved together - castling complete!');
                        }, 1500);
                        break;
                        
                    case 'enpassant':
                        // Set up en passant scenario
                        const whitePawn = document.querySelector('[data-row="4"][data-col="3"]');
                        const blackPawn = document.querySelector('[data-row="4"][data-col="4"]');
                        const captureSquare = document.querySelector('[data-row="5"][data-col="4"]');
                        
                        whitePawn.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôü</span>';
                        blackPawn.innerHTML = '<span style="color: #e74c3c; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôü</span>';
                        blackPawn.classList.add('enemy');
                        
                        setTimeout(() => {
                            whitePawn.innerHTML = '';
                            blackPawn.innerHTML = '';
                            blackPawn.classList.remove('enemy');
                            captureSquare.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôü</span>';
                            captureSquare.classList.add('special-move');
                            showCelebration('üëª En passant capture - pawn captured "in passing"!');
                        }, 1500);
                        break;
                        
                    case 'promotion':
                        // Pawn promotion
                        const promotePawn = document.querySelector('[data-row="6"][data-col="3"]');
                        const promoteSquare = document.querySelector('[data-row="7"][data-col="3"]');
                        
                        promotePawn.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôü</span>';
                        
                        setTimeout(() => {
                            promotePawn.innerHTML = '';
                            promoteSquare.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôõ</span>';
                            promoteSquare.classList.add('special-move');
                            showCelebration('üëë Pawn promoted to queen - most powerful transformation!');
                        }, 1500);
                        break;
                        
                    case 'check':
                        // Check scenario
                        const king = document.querySelector('[data-row="0"][data-col="4"]');
                        const attackingQueen = document.querySelector('[data-row="0"][data-col="0"]');
                        
                        king.innerHTML = '<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôö</span>';
                        attackingQueen.innerHTML = '<span style="color: #e74c3c; text-shadow: 1px 1px 2px #ffffff; font-size: 28px;">‚ôõ</span>';
                        attackingQueen.classList.add('enemy');
                        
                        // Highlight attack path
                        for (let i = 1; i < 4; i++) {
                            const pathSquare = document.querySelector(`[data-row="0"][data-col="${i}"]`);
                            pathSquare.classList.add('capture-move');
                        }
                        king.classList.add('capture-move');
                        showCelebration('‚ö†Ô∏è CHECK! The king is under attack and must move to safety!');
                        break;
                }
            }, 1000);
        }

        function startChallenge(challenge) {
            currentChallenge = challenge;
            const modal = document.getElementById('challengeModal');
            const title = document.getElementById('modalTitle');
            const description = document.getElementById('modalDescription');
            
            // Challenge configurations
            const challenges = {
                'pawn-race': {
                    title: 'üèÉ‚Äç‚ôÇÔ∏è Pawn Race Challenge',
                    description: 'Move your pawn from a2 to a8 in the minimum number of moves. Remember: pawns can move 2 squares on their first move!',
                    startPos: {row: 1, col: 0},
                    targetPos: {row: 7, col: 0},
                    piece: '‚ôü',
                    hints: [
                        'Pawns can move 2 squares on their first move!',
                        'After the first move, pawns can only move 1 square forward.',
                        'Click on a2 to start, then move to a4, then a5, a6, a7, a8!'
                    ]
                },
                'knight-moves': {
                    title: 'üêé Knight Training Challenge',
                    description: 'Move the knight from b1 to reach the center square e4. Learn the L-shaped movement pattern!',
                    startPos: {row: 0, col: 1},
                    targetPos: {row: 3, col: 4},
                    piece: '‚ôû',
                    hints: [
                        'Knights move in an L-shape: 2 squares in one direction, then 1 square perpendicular.',
                        'Knights can jump over other pieces!',
                        'Try: b1 ‚Üí d2 ‚Üí e4, or b1 ‚Üí c3 ‚Üí e4!'
                    ]
                },
                'rook-path': {
                    title: 'üè∞ Rook Highway Challenge',
                    description: 'Move the rook from a1 to h8 in exactly 2 moves. Find the shortest path!',
                    startPos: {row: 0, col: 0},
                    targetPos: {row: 7, col: 7},
                    piece: '‚ôú',
                    hints: [
                        'Rooks move in straight lines - horizontally or vertically.',
                        'You need exactly 2 moves to reach h8.',
                        'Try: a1 ‚Üí a8 ‚Üí h8, or a1 ‚Üí h1 ‚Üí h8!'
                    ]
                },
                'bishop-diagonal': {
                    title: '‚ö° Bishop Journey Challenge',
                    description: 'Move the bishop from c1 to capture the target on f4. Follow the diagonal path!',
                    startPos: {row: 0, col: 2},
                    targetPos: {row: 3, col: 5},
                    piece: '‚ôù',
                    hints: [
                        'Bishops move diagonally only.',
                        'They always stay on the same color squares.',
                        'From c1, you can reach f4 in one diagonal move!'
                    ]
                }
            };
            
            challengeData = challenges[challenge];
            title.textContent = challengeData.title;
            description.textContent = challengeData.description;
            
            // Create challenge board
            createChallengeBoard();
            
            modal.style.display = 'block';
            
            showCelebration(`üéÆ Starting ${challengeData.title}!`);
        }

        function createChallengeBoard() {
            const board = document.getElementById('modalBoard');
            board.innerHTML = '';
            
            for (let row = 7; row >= 0; row--) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `challenge-square ${(row + col) % 2 === 0 ? 'black' : 'white'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.onclick = () => challengeMove(square);
                    
                    // Place starting piece
                    if (row === challengeData.startPos.row && col === challengeData.startPos.col) {
                        square.innerHTML = `<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff;">${challengeData.piece}</span>`;
                        square.style.background = '#4caf50';
                    }
                    
                    // Mark target
                    if (row === challengeData.targetPos.row && col === challengeData.targetPos.col) {
                        square.style.background = '#ff5722';
                        square.innerHTML = '<span style="color: white; font-weight: bold;">üéØ</span>';
                    }
                    
                    board.appendChild(square);
                }
            }
            
            challengeData.currentPos = {...challengeData.startPos};
            challengeData.moves = 0;
        }

        function challengeMove(square) {
            const row = parseInt(square.dataset.row);
            const col = parseInt(square.dataset.col);
            
            // Check if move is valid (simplified)
            const currentSquare = document.querySelector(`[data-row="${challengeData.currentPos.row}"][data-col="${challengeData.currentPos.col}"]`);
            
            if (row === challengeData.targetPos.row && col === challengeData.targetPos.col) {
                // Success!
                challengesCompleted.add(currentChallenge);
                updateProgress();
                
                // Mark challenge as completed
                const challengeCard = document.querySelector(`[onclick="startChallenge('${currentChallenge}')"]`);
                challengeCard.classList.add('completed');
                
                showCelebration('üèÜ Challenge completed! Great job!');
                setTimeout(() => closeModal(), 2000);
            } else {
                // Move piece
                currentSquare.innerHTML = '';
                currentSquare.style.background = '';
                square.innerHTML = `<span style="color: #2d3436; text-shadow: 1px 1px 2px #ffffff;">${challengeData.piece}</span>`;
                square.style.background = '#4caf50';
                
                challengeData.currentPos = {row, col};
                challengeData.moves++;
                
                showCelebration(`Move ${challengeData.moves} completed!`);
            }
        }

        function getHint() {
            const hintBox = document.getElementById('hintBox');
            const hints = challengeData.hints;
            const hintIndex = Math.min(challengeData.moves, hints.length - 1);
            
            hintBox.textContent = `üí° Hint: ${hints[hintIndex]}`;
            hintBox.classList.add('show');
        }

        function resetChallenge() {
            createChallengeBoard();
            document.getElementById('hintBox').classList.remove('show');
        }

        function closeModal() {
            document.getElementById('challengeModal').style.display = 'none';
            document.getElementById('hintBox').classList.remove('show');
        }

        function selectQuizAnswer(option, questionNumber, correctness) {
            // Disable all options for this question
            const questionContainer = option.closest('.quiz-question-container');
            const allOptions = questionContainer.querySelectorAll('.quiz-option');
            const resultDiv = document.getElementById(`result${questionNumber}`);
            
            // If already answered, return
            if (option.classList.contains('disabled')) {
                return;
            }
            
            // Mark this question as answered
            quizAnswered.add(`question-${questionNumber}`);
            updateProgress();
            
            // Disable all options and show correct answers
            allOptions.forEach(opt => {
                opt.classList.add('disabled');
                // Show the correct answer
                if (opt.onclick.toString().includes('correct')) {
                    opt.classList.add('correct');
                } else if (opt === option && correctness === 'incorrect') {
                    opt.classList.add('incorrect');
                }
            });
            
            // Show result message
            if (correctness === 'correct') {
                resultDiv.textContent = '‚úÖ Excellent! That\'s the correct answer!';
                resultDiv.className = 'quiz-result correct show';
                showCelebration('üéâ Correct answer! You\'re mastering chess movements!');
            } else {
                resultDiv.textContent = '‚ùå Not quite right. The correct answer is highlighted in green above.';
                resultDiv.className = 'quiz-result incorrect show';
                showCelebration('üìö Keep learning! The correct answer is now highlighted.');
            }
        }

        function updateProgress() {
            const totalItems = 6 + 4 + 4 + 6; // pieces + specials + challenges + quiz questions
            const completedItems = movesLearned.size + specialMovesLearned.size + challengesCompleted.size + quizAnswered.size;
            const progress = Math.round((completedItems / totalItems) * 100);
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Movement Mastery: ${progress}%`;
            
            saveProgress();
        }

        function saveProgress() {
            window.chessProgress = window.chessProgress || {};
            window.chessProgress.moves = {
                movesLearned: Array.from(movesLearned),
                specialMovesLearned: Array.from(specialMovesLearned),
                challengesCompleted: Array.from(challengesCompleted),
                quizAnswered: Array.from(quizAnswered),
                completedAt: new Date().toISOString()
            };
        }

        function loadProgress() {
            if (window.chessProgress && window.chessProgress.moves) {
                const saved = window.chessProgress.moves;
                
                movesLearned = new Set(saved.movesLearned || ['pawn']);
                specialMovesLearned = new Set(saved.specialMovesLearned || []);
                challengesCompleted = new Set(saved.challengesCompleted || []);
                
                // Mark completed pieces
                movesLearned.forEach(piece => {
                    const btn = document.querySelector(`[onclick*="selectPiece('${piece}'"]`);
                    if (btn) btn.classList.add('completed');
                });
                
                // Mark completed special moves
                specialMovesLearned.forEach(special => {
                    const card = document.querySelector(`[onclick="demonstrateSpecial('${special}')"]`);
                    if (card) card.classList.add('learned');
                });
                
                // Mark completed challenges
                challengesCompleted.forEach(challenge => {
                    const card = document.querySelector(`[onclick="startChallenge('${challenge}')"]`);
                    if (card) card.classList.add('completed');
                });
                
                if (saved.quizAnswered && saved.quizAnswered.length > 0) {
                    quizAnswered = new Set(saved.quizAnswered);
                }
                
                updateProgress();
            }
        }

        function completeMoves() {
            const totalItems = 6 + 4 + 4 + 6;
            const completedItems = movesLearned.size + specialMovesLearned.size + challengesCompleted.size + quizAnswered.size;
            
            saveProgress();
            
            if (completedItems >= totalItems * 0.7) {
                showCelebration('üèÜ Incredible! You\'ve mastered chess movements!');
                
                for (let i = 0; i < 50; i++) {
                    createConfetti();
                }
                
                setTimeout(() => {
                    if (confirm('üß† Ready for the ultimate chess quiz? Click OK to test everything you\'ve learned!')) {
                        window.location.href = 'quiz.html';
                    }
                }, 2000);
            } else {
                showCelebration('üéØ Try more piece movements, special moves, and challenges to become a true master!');
            }
        }Answered = new Set(saved.quizAnswered);
                }
                
                updateProgress();
            }
        }

        function completeMoves() {
            const totalItems = 6 + 6;
            const completedItems = movesLearned.size + quizAnswered.size;
            
            saveProgress();
            
            if (completedItems >= totalItems * 0.7) {
                showCelebration('üèÜ Incredible! You\'ve mastered chess movements!');
                
                for (let i = 0; i < 50; i++) {
                    createConfetti();
                }
                
                setTimeout(() => {
                    if (confirm('üß† Ready for the ultimate chess quiz? Click OK to test everything you\'ve learned!')) {
                        window.location.href = 'quiz.html';
                    }
                }, 2000);
            } else {
                showCelebration('üéØ Try more piece movements and complete the quiz to become a true master!');
            }
        }

        function showCelebration(message) {
            const celebration = document.getElementById('celebration');
            celebration.textContent = message;
            celebration.classList.add('show');
            
            setTimeout(() => {
                celebration.classList.remove('show');
            }, 4000);
        }

        function createConfetti() {
            const symbols = ['üöÄ', '‚ôü', '‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö', 'üéâ', 'üéä', '‚≠ê', 'üèÜ'];
            const confetti = document.createElement('div');
            confetti.textContent = symbols[Math.floor(Math.random() * symbols.length)];
            confetti.style.position = 'fixed';
            confetti.style.fontSize = '25px';
            confetti.style.left = Math.random() * window.innerWidth + 'px';
            confetti.style.top = '-50px';
            confetti.style.zIndex = '1000';
            confetti.style.pointerEvents = 'none';
            
            document.body.appendChild(confetti);
            
            const animation = confetti.animate([
                { transform: 'translateY(-50px) rotate(0deg)', opacity: 1 },
                { transform: `translateY(${window.innerHeight + 50}px) rotate(360deg)`, opacity: 0 }
            ], {
                duration: 2000 + Math.random() * 1000,
                easing: 'ease-out'
            });
            
            animation.onfinish = () => confetti.remove();
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            createDemoBoard();
            updateMovementInfo('pawn'); // Start with pawn info
            showCelebration('üöÄ Welcome to Movement Mastery! Click on pieces to learn how they move!');
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('challengeModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>