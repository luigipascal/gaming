<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ How Chess Pieces Move - Master Every Movement!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3em;
            color: #4a5568;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .movement-selector {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .piece-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .piece-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            border: none;
            padding: 15px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            min-width: 120px;
        }

        .piece-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .piece-btn.active {
            background: linear-gradient(45deg, #e17055, #fdcb6e);
            transform: scale(1.05);
        }

        .demo-board-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .demo-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 2px;
            margin: 20px auto;
            background: #8b4513;
            padding: 10px;
            border-radius: 10px;
            justify-content: center;
        }

        .demo-square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            position: relative;
        }

        .demo-square.white {
            background: #f0d9b5;
        }

        .demo-square.black {
            background: #b58863;
        }

        .demo-square.piece-position {
            background: #4caf50 !important;
            animation: pulse 2s infinite;
        }

        .demo-square.valid-move {
            background: #ffeb3b !important;
        }

        .demo-square.capture-move {
            background: #ff5722 !important;
        }

        .demo-square.special-move {
            background: #9c27b0 !important;
        }

        .demo-square:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .movement-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .movement-info h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .movement-rules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .rule-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .rule-card h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .rule-card ul {
            list-style: none;
            padding: 0;
        }

        .rule-card li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .rule-card li:before {
            content: "‚≠ê";
            position: absolute;
            left: 0;
        }

        .special-moves {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .special-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .special-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .special-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .special-card .emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .interactive-challenges {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .challenge-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .challenge-card.completed {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4caf50;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #e91e63, #f06292);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tips-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tip-card {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #e17055;
        }

        .tip-card h4 {
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .quiz-section {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 25px 0;
        }

        .quiz-question {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-question:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.02);
        }

        .quiz-question.correct {
            background: #d4edda;
            border: 3px solid #28a745;
        }

        .quiz-question.incorrect {
            background: #f8d7da;
            border: 3px solid #dc3545;
        }

        .celebration {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .celebration.show {
            opacity: 1;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .demo-board {
                grid-template-columns: repeat(8, 45px);
                grid-template-rows: repeat(8, 45px);
            }
            
            .demo-square {
                width: 45px;
                height: 45px;
                font-size: 24px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-btn" onclick="goBack()">‚¨ÖÔ∏è Back to Chess Kingdom</button>
        
        <div class="header">
            <h1>üöÄ Master Chess Piece Movements!</h1>
            <p style="font-size: 1.2em; color: #666;">Learn how each piece moves and become a movement master!</p>
        </div>

        <div class="movement-selector">
            <h2>üéØ Choose a Piece to Practice</h2>
            <div class="piece-buttons">
                <button class="piece-btn active" onclick="selectPiece('pawn')">‚ôüÔ∏è Pawn</button>
                <button class="piece-btn" onclick="selectPiece('rook')">‚ôú Rook</button>
                <button class="piece-btn" onclick="selectPiece('knight')">‚ôû Knight</button>
                <button class="piece-btn" onclick="selectPiece('bishop')">‚ôù Bishop</button>
                <button class="piece-btn" onclick="selectPiece('queen')">‚ôõ Queen</button>
                <button class="piece-btn" onclick="selectPiece('king')">‚ôö King</button>
            </div>
        </div>

        <div class="demo-board-container">
            <h3 id="currentPieceTitle">‚ôüÔ∏è Pawn Movement Demo</h3>
            <p id="currentPieceDescription">Click anywhere on the board to place a pawn and see how it moves!</p>
            
            <div class="demo-board" id="demoBoard">
                <!-- Board will be generated by JavaScript -->
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="clearBoard()">üîÑ Clear Board</button>
                <button class="control-btn" onclick="randomPosition()">üé≤ Random Position</button>
                <button class="control-btn" onclick="showCaptures()">‚öîÔ∏è Show Captures</button>
                <button class="control-btn" onclick="animateMovement()">üé¨ Animate Move</button>
            </div>
        </div>

        <div class="movement-info" id="movementInfo">
            <h3>‚ôüÔ∏è Pawn Movement Rules</h3>
            <div class="movement-rules">
                <div class="rule-card">
                    <h4>üéØ Basic Movement</h4>
                    <ul>
                        <li>Moves forward one square</li>
                        <li>Can move two squares on first move</li>
                        <li>Cannot move backwards</li>
                        <li>Cannot jump over pieces</li>
                    </ul>
                </div>
                <div class="rule-card">
                    <h4>‚öîÔ∏è How It Captures</h4>
                    <ul>
                        <li>Captures diagonally forward</li>
                        <li>One square diagonally only</li>
                        <li>Cannot capture straight ahead</li>
                        <li>Special "en passant" capture</li>
                    </ul>
                </div>
                <div class="rule-card">
                    <h4>‚≠ê Special Abilities</h4>
                    <ul>
                        <li>Promotes when reaching end</li>
                        <li>Can become any piece except king</li>
                        <li>Usually promotes to queen</li>
                        <li>Most powerful transformation!</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="special-moves">
            <h2 style="text-align: center; margin-bottom: 25px;">‚ú® Special Chess Moves</h2>
            <div class="special-grid">
                <div class="special-card" onclick="demonstrateSpecial('castling')">
                    <div class="emoji">üè∞</div>
                    <h3>Castling</h3>
                    <p>King and rook move together for safety! A special defensive move.</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('enpassant')">
                    <div class="emoji">üëª</div>
                    <h3>En Passant</h3>
                    <p>Pawn captures "in passing" - a sneaky capture move!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('promotion')">
                    <div class="emoji">üëë</div>
                    <h3>Pawn Promotion</h3>
                    <p>Pawn becomes a queen (or other piece) when reaching the end!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('check')">
                    <div class="emoji">‚ö†Ô∏è</div>
                    <h3>Check</h3>
                    <p>When the king is under attack and must move to safety!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('checkmate')">
                    <div class="emoji">üèÜ</div>
                    <h3>Checkmate</h3>
                    <p>King is trapped with no escape - game over!</p>
                </div>
                
                <div class="special-card" onclick="demonstrateSpecial('stalemate')">
                    <div class="emoji">ü§ù</div>
                    <h3>Stalemate</h3>
                    <p>No legal moves available but king not in check - it's a draw!</p>
                </div>
            </div>
        </div>

        <div class="interactive-challenges">
            <h2 style="text-align: center; margin-bottom: 25px;">üéÆ Movement Challenges</h2>
            <div class="challenge-grid">
                <div class="challenge-card" onclick="startChallenge('pawn-race')">
                    <h3>üèÉ‚Äç‚ôÇÔ∏è Pawn Race</h3>
                    <p>Get your pawn to the other end as fast as possible!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê Difficulty: Easy</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('knight-tour')">
                    <h3>üêé Knight's Tour</h3>
                    <p>Visit every square on the board with a knight!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê‚≠ê Difficulty: Hard</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('rook-maze')">
                    <h3>üè∞ Rook Maze</h3>
                    <p>Navigate the rook through obstacles to reach the target!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê Difficulty: Medium</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('bishop-diagonal')">
                    <h3>‚ö° Bishop Diagonal</h3>
                    <p>Control all four long diagonals with your bishops!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê Difficulty: Medium</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('queen-power')">
                    <h3>üëë Queen Power</h3>
                    <p>Use the queen to capture all enemy pieces in minimum moves!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê‚≠ê Difficulty: Hard</div>
                </div>
                
                <div class="challenge-card" onclick="startChallenge('king-safety')">
                    <h3>üõ°Ô∏è King Safety</h3>
                    <p>Move the king to safety while avoiding enemy attacks!</p>
                    <div style="font-size: 0.9em; margin-top: 10px;">‚≠ê‚≠ê Difficulty: Medium</div>
                </div>
            </div>
        </div>

        <div class="tips-section">
            <h2>üí° Pro Movement Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <h4>üéØ Control the Center</h4>
                    <p>Move pawns to d4, d5, e4, e5 early in the game. Center control gives your pieces more mobility and power!</p>
                </div>
                
                <div class="tip-card">
                    <h4>üêé Knights Love Outposts</h4>
                    <p>Place knights on squares where enemy pawns can't attack them. These "outpost" squares make knights super strong!</p>
                </div>
                
                <div class="tip-card">
                    <h4>‚ôú Rooks on Open Files</h4>
                    <p>Put rooks on files (columns) with no pawns. Open files let rooks attack deep into enemy territory!</p>
                </div>
                
                <div class="tip-card">
                    <h4>‚ôù Bishop Pairs</h4>
                    <p>Keep both bishops when possible! The "bishop pair" working together can dominate the board.</p>
                </div>
                
                <div class="tip-card">
                    <h4>‚ôõ Queen Safety</h4>
                    <p>Don't bring your queen out too early! She's powerful but can be attacked easily in the opening.</p>
                </div>
                
                <div class="tip-card">
                    <h4>‚ôö King Security</h4>
                    <p>Castle early to keep your king safe! A secure king lets you attack without worry.</p>
                </div>
            </div>
        </div>

        <div class="quiz-section">
            <h2 style="text-align: center; margin-bottom: 25px;">üß† Movement Mastery Quiz!</h2>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, true)">
                <strong>Which piece can jump over other pieces?</strong><br>
                <span style="font-size: 0.9em;">A) The Knight ‚ôû</span>
            </div>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, false)">
                <strong>Which piece can jump over other pieces?</strong><br>
                <span style="font-size: 0.9em;">B) The Queen ‚ôõ</span>
            </div>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, true)">
                <strong>How does a pawn capture?</strong><br>
                <span style="font-size: 0.9em;">A) Diagonally forward</span>
            </div>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, false)">
                <strong>How does a pawn capture?</strong><br>
                <span style="font-size: 0.9em;">B) Straight forward</span>
            </div>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, true)">
                <strong>What special move involves the king and rook?</strong><br>
                <span style="font-size: 0.9em;">A) Castling</span>
            </div>
            
            <div class="quiz-question" onclick="checkMovementQuiz(this, false)">
                <strong>What special move involves the king and rook?</strong><br>
                <span style="font-size: 0.9em;">B) En passant</span>
            </div>
        </div>

        <div class="celebration" id="celebration"></div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="completeMoves()" class="back-btn" style="font-size: 1.2em; padding: 20px 35px;">
                ‚úÖ I've Mastered All Movements!
            </button>
        </div>
    </div>

    <script>
        let currentPiece = 'pawn';
        let piecePosition = null;
        let movesLearned = new Set();
        let challengesCompleted = new Set();
        let specialMovesLearned = new Set();
        let quizAnswered = new Set();

        const pieceMovements = {
            pawn: {
                title: '‚ôüÔ∏è Pawn Movement Demo',
                description: 'Click anywhere on the board to place a pawn and see how it moves!',
                emoji: '‚ôüÔ∏è',
                rules: {
                    basic: ['Moves forward one square', 'Can move two squares on first move', 'Cannot move backwards', 'Cannot jump over pieces'],
                    capture: ['Captures diagonally forward', 'One square diagonally only', 'Cannot capture straight ahead', 'Special "en passant" capture'],
                    special: ['Promotes when reaching end', 'Can become any piece except king', 'Usually promotes to queen', 'Most powerful transformation!']
                }
            },
            rook: {
                title: '‚ôú Rook Movement Demo',
                description: 'Click to place a rook and see its powerful straight-line movement!',
                emoji: '‚ôú',
                rules: {
                    basic: ['Moves horizontally any distance', 'Moves vertically any distance', 'Cannot move diagonally', 'Cannot jump over pieces'],
                    capture: ['Captures any piece in its path', 'Stops at the captured piece', 'Great for controlling files and ranks', 'Powerful in endgames'],
                    special: ['Can castle with the king', 'Loves open files and ranks', 'Strongest on 7th rank', 'Perfect for back rank attacks']
                }
            },
            knight: {
                title: '‚ôû Knight Movement Demo',
                description: 'Watch the knight hop in its unique L-shaped pattern!',
                emoji: '‚ôû',
                rules: {
                    basic: ['Moves in an "L" shape', '2 squares + 1 square perpendicular', 'Only piece that can jump', 'Always lands on opposite color'],
                    capture: ['Captures piece on landing square', 'Cannot be blocked by other pieces', 'Great for surprise attacks', 'Excellent piece for forks'],
                    special: ['Always changes square color', 'Can reach any square eventually', 'Strongest in closed positions', 'Knight vs bishop depends on position']
                }
            },
            bishop: {
                title: '‚ôù Bishop Movement Demo',
                description: 'See how bishops glide along their diagonal paths!',
                emoji: '‚ôù',
                rules: {
                    basic: ['Moves diagonally any distance', 'Always stays on same color', 'Cannot jump over pieces', 'Each player starts with 2 bishops'],
                    capture: ['Captures along diagonal paths', 'Stops at captured piece', 'Can attack from long distance', 'Great for controlling diagonals'],
                    special: ['One light-square, one dark-square', 'Bishop pair is very strong', 'Stronger in open positions', 'Can control long diagonals']
                }
            },
            queen: {
                title: '‚ôõ Queen Movement Demo',
                description: 'Experience the queen\'s incredible power and versatility!',
                emoji: '‚ôõ',
                rules: {
                    basic: ['Combines rook and bishop moves', 'Any direction, any distance', 'Most powerful piece', 'Cannot jump over pieces'],
                    capture: ['Can capture in any direction', 'Extremely dangerous in attack', 'Can control many squares', 'Often targets of attack'],
                    special: ['Worth about 9 points', 'Keep safe in opening', 'Devastating in middlegame', 'Can checkmate with king alone']
                }
            },
            king: {
                title: '‚ôö King Movement Demo',
                description: 'Learn the king\'s careful, one-square movements!',
                emoji: '‚ôö',
                rules: {
                    basic: ['Moves one square any direction', 'Cannot move into check', 'Most important piece', 'Must be protected always'],
                    capture: ['Can capture adjacent pieces', 'Cannot capture defended pieces', 'Rarely captures in opening', 'More active in endgame'],
                    special: ['Can castle for safety', 'Cannot castle through check', 'Central in endgames', 'Never leaves the board']
                }
            }
        };

        function goBack() {
            window.history.back();
        }

        function createDemoBoard() {
            const board = document.getElementById('demoBoard');
            board.innerHTML = '';
            
            for (let row = 7; row >= 0; row--) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `demo-square ${(row + col) % 2 === 0 ? 'black' : 'white'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.dataset.square = String.fromCharCode(97 + col) + (row + 1);
                    square.onclick = () => placePiece(square);
                    board.appendChild(square);
                }
            }
        }

        function selectPiece(piece) {
            currentPiece = piece;
            movesLearned.add(piece);
            
            // Update button states
            document.querySelectorAll('.piece-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update display
            const pieceData = pieceMovements[piece];
            document.getElementById('currentPieceTitle').textContent = pieceData.title;
            document.getElementById('currentPieceDescription').textContent = pieceData.description;
            
            // Update movement info
            updateMovementInfo(piece);
            
            // Clear board
            clearBoard();
            
            showCelebration(`üéØ Now practicing ${pieceData.emoji} ${piece} movements!`);
        }

        function updateMovementInfo(piece) {
            const info = document.getElementById('movementInfo');
            const pieceData = pieceMovements[piece];
            
            info.innerHTML = `
                <h3>${pieceData.emoji} ${piece.charAt(0).toUpperCase() + piece.slice(1)} Movement Rules</h3>
                <div class="movement-rules">
                    <div class="rule-card">
                        <h4>üéØ Basic Movement</h4>
                        <ul>
                            ${pieceData.rules.basic.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="rule-card">
                        <h4>‚öîÔ∏è How It Captures</h4>
                        <ul>
                            ${pieceData.rules.capture.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="rule-card">
                        <h4>‚≠ê Special Abilities</h4>
                        <ul>
                            ${pieceData.rules.special.map(rule => `<li>${rule}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function placePiece(square) {
            // Clear previous piece and moves
            clearBoard();
            
            // Place piece
            square.textContent = pieceMovements[currentPiece].emoji;
            square.classList.add('piece-position');
            piecePosition = {
                row: parseInt(square.dataset.row),
                col: parseInt(square.dataset.col),
                square: square
            };
            
            // Show valid moves
            showValidMoves();
            
            showCelebration(`${pieceMovements[currentPiece].emoji} placed on ${square.dataset.square}!`);
        }

        function showValidMoves() {
            if (!piecePosition) return;
            
            const moves = calculateMoves(currentPiece, piecePosition.row, piecePosition.col);
            const squares = document.querySelectorAll('.demo-square');
            
            moves.forEach(move => {
                const targetSquare = document.querySelector(`[data-row="${move.row}"][data-col="${move.col}"]`);
                if (targetSquare) {
                    if (move.type === 'capture') {
                        targetSquare.classList.add('capture-move');
                        targetSquare.textContent = '√ó';
                    } else if (move.type === 'special') {
                        targetSquare.classList.add('special-move');
                        targetSquare.textContent = '‚òÖ';
                    } else {
                        targetSquare.classList.add('valid-move');
                        targetSquare.textContent = '‚Ä¢';
                    }
                }
            });
        }

        function calculateMoves(piece, row, col) {
            const moves = [];
            
            switch(piece) {
                case 'pawn':
                    // Forward moves
                    if (row < 7) {
                        moves.push({row: row + 1, col: col, type: 'normal'});
                        if (row === 1) { // First move
                            moves.push({row: row + 2, col: col, type: 'special'});
                        }
                    }
                    // Captures
                    if (row < 7 && col > 0) moves.push({row: row + 1, col: col - 1, type: 'capture'});
                    if (row < 7 && col < 7) moves.push({row: row + 1, col: col + 1, type: 'capture'});
                    break;
                    
                case 'rook':
                    // Horizontal and vertical moves
                    for (let i = 0; i < 8; i++) {
                        if (i !== col) moves.push({row: row, col: i, type: 'normal'});
                        if (i !== row) moves.push({row: i, col: col, type: 'normal'});
                    }
                    break;
                    
                case 'knight':
                    const knightMoves = [
                        [-2, -1], [-2, 1], [-1, -2], [-1, 2],
                        [1, -2], [1, 2], [2, -1], [2, 1]
                    ];
                    knightMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'normal'});
                        }
                    });
                    break;
                    
                case 'bishop':
                    // Diagonal moves
                    const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
                    directions.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'normal'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'queen':
                    // Combine rook and bishop moves
                    const allDirections = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    allDirections.forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const newRow = row + dr * i;
                            const newCol = col + dc * i;
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                moves.push({row: newRow, col: newCol, type: 'normal'});
                            } else break;
                        }
                    });
                    break;
                    
                case 'king':
                    // One square in any direction
                    const kingMoves = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],           [0, 1],
                        [1, -1],  [1, 0],  [1, 1]
                    ];
                    kingMoves.forEach(([dr, dc]) => {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            moves.push({row: newRow, col: newCol, type: 'normal'});
                        }
                    });
                    // Castling
                    if (row === 0 && col === 4) { // King on starting square
                        moves.push({row: 0, col: 2, type: 'special'}); // Queen side
                        moves.push({row: 0, col: 6, type: 'special'}); // King side
                    }
                    break;
            }
            
            return moves;
        }

        function clearBoard() {
            document.querySelectorAll('.demo-square').forEach(square => {
                square.textContent = '';
                square.classList.remove('piece-position', 'valid-move', 'capture-move', 'special-move');
            });
            piecePosition = null;
        }

        function randomPosition() {
            const row = Math.floor(Math.random() * 8);
            const col = Math.floor(Math.random() * 8);
            const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            placePiece(square);
        }

        function showCaptures() {
            if (!piecePosition) {
                showCelebration('Place a piece first to see captures!');
                return;
            }
            
            // Add some enemy pieces randomly
            const squares = document.querySelectorAll('.demo-square');
            let enemyCount = 0;
            
            squares.forEach(square => {
                if (!square.classList.contains('piece-position') && Math.random() < 0.1 && enemyCount < 4) {
                    square.textContent = '‚ôü';
                    square.style.color = '#e74c3c';
                    enemyCount++;
                }
            });
            
            showValidMoves();
            showCelebration('üó°Ô∏è Enemy pieces added! See which ones you can capture!');
        }

        function animateMovement() {
            if (!piecePosition) {
                randomPosition();
            }
            
            const moves = calculateMoves(currentPiece, piecePosition.row, piecePosition.col);
            if (moves.length === 0) return;
            
            const randomMove = moves[Math.floor(Math.random() * moves.length)];
            const targetSquare = document.querySelector(`[data-row="${randomMove.row}"][data-col="${randomMove.col}"]`);
            
            // Animate movement
            const piece = piecePosition.square;
            piece.style.transform = 'scale(1.3)';
            piece.style.zIndex = '100';
            
            setTimeout(() => {
                // Move piece
                piece.textContent = '';
                piece.classList.remove('piece-position');
                targetSquare.textContent = pieceMovements[currentPiece].emoji;
                targetSquare.classList.add('piece-position');
                targetSquare.style.transform = 'scale(1.3)';
                
                piecePosition = {
                    row: randomMove.row,
                    col: randomMove.col,
                    square: targetSquare
                };
                
                setTimeout(() => {
                    piece.style.transform = '';
                    targetSquare.style.transform = '';
                    piece.style.zIndex = '';
                    showValidMoves();
                }, 500);
            }, 500);
            
            showCelebration('üé¨ Watch the piece move!');
        }

        function demonstrateSpecial(specialMove) {
            specialMovesLearned.add(specialMove);
            clearBoard();
            
            const explanations = {
                castling: "üè∞ Castling: King moves 2 squares toward rook, rook jumps to other side. Great for king safety!",
                enpassant: "üëª En Passant: When enemy pawn moves 2 squares, you can capture 'in passing' as if it moved 1!",
                promotion: "üëë Promotion: When pawn reaches end of board, it becomes any piece you choose (usually queen)!",
                check: "‚ö†Ô∏è Check: When king is attacked, it must move to safety immediately. Say 'Check!'",
                checkmate: "üèÜ Checkmate: King is attacked and has no escape moves. Game over - you win!",
                stalemate: "ü§ù Stalemate: Player has no legal moves but king isn't in check. Game is a draw!"
            };
            
            showCelebration(explanations[specialMove]);
            
            // Set up demonstration position
            const board = document.getElementById('demoBoard');
            switch(specialMove) {
                case 'castling':
                    document.querySelector('[data-row="0"][data-col="4"]').textContent = '‚ôö';
                    document.querySelector('[data-row="0"][data-col="7"]').textContent = '‚ôú';
                    document.querySelector('[data-row="0"][data-col="6"]').classList.add('special-move');
                    document.querySelector('[data-row="0"][data-col="5"]').classList.add('special-move');
                    break;
                case 'promotion':
                    document.querySelector('[data-row="6"][data-col="3"]').textContent = '‚ôü';
                    document.querySelector('[data-row="7"][data-col="3"]').classList.add('special-move');
                    document.querySelector('[data-row="7"][data-col="3"]').textContent = 'üëë';
                    break;
            }
        }

        function startChallenge(challenge) {
            challengesCompleted.add(challenge);
            event.target.classList.add('completed');
            
            const challenges = {
                'pawn-race': 'üèÉ‚Äç‚ôÇÔ∏è Pawn Race: Move your pawn from a2 to a8 in minimum moves!',
                'knight-tour': 'üêé Knight Tour: Visit all 64 squares with your knight - ultimate challenge!',
                'rook-maze': 'üè∞ Rook Maze: Navigate around obstacles to reach the target square!',
                'bishop-diagonal': '‚ö° Bishop Challenge: Control both long diagonals with your bishops!',
                'queen-power': 'üëë Queen Power: Capture 8 enemy pieces in 8 moves - use her power!',
                'king-safety': 'üõ°Ô∏è King Safety: Move king to safety while avoiding enemy attacks!'
            };
            
            showCelebration(challenges[challenge]);
            clearBoard();
        }

        function checkMovementQuiz(element, isCorrect) {
            if (element.classList.contains('correct') || element.classList.contains('incorrect')) {
                return; // Already answered
            }
            
            quizAnswered.add(element);
            
            if (isCorrect) {
                element.classList.add('correct');
                element.innerHTML += '<div style="margin-top: 10px; color: #28a745; font-weight: bold;">‚úÖ Correct! You\'re a movement master!</div>';
                showCelebration('üéâ Perfect! You understand how pieces move!');
            } else {
                element.classList.add('incorrect');
                element.innerHTML += '<div style="margin-top: 10px; color: #dc3545; font-weight: bold;">‚ùå Not quite! Keep practicing movements!</div>';
            }
        }

        function completeMoves() {
            const totalItems = 6 + 6 + 6 + 6; // pieces + specials + challenges + quiz
            const completedItems = movesLearned.size + specialMovesLearned.size + challengesCompleted.size + quizAnswered.size;
            
            if (completedItems >= totalItems * 0.6) { // 60% completion
                showCelebration('üèÜ Incredible! You\'ve mastered chess movements! Ready for the ultimate quiz?');
                
                // Add confetti effect
                for (let i = 0; i < 50; i++) {
                    createConfetti();
                }
                
                // Mark this section as completed for progress tracking
                if (window.parent && window.parent.markSectionComplete) {
                    window.parent.markSectionComplete('moves');
                }
                
                setTimeout(() => {
                    if (confirm('üß† Ready for the ultimate chess quiz? Click OK to test everything you\'ve learned!')) {
                        window.location.href = 'quiz.html';
                    } else {
                        window.location.href = 'index.html?completed=moves';
                    }
                }, 2000);
            } else {
                showCelebration('üéØ Try more piece movements, special moves, and challenges to become a true master!');
            }
        }

        function showCelebration(message) {
            const celebration = document.getElementById('celebration');
            celebration.textContent = message;
            celebration.classList.add('show');
            
            setTimeout(() => {
                celebration.classList.remove('show');
            }, 4000);
        }

        function createConfetti() {
            const symbols = ['üöÄ', '‚ôüÔ∏è', '‚ôú', '‚ôû', '‚ôù', '‚ôõ', '‚ôö', 'üéâ', 'üéä', '‚≠ê', 'üèÜ'];
            const confetti = document.createElement('div');
            confetti.textContent = symbols[Math.floor(Math.random() * symbols.length)];
            confetti.style.position = 'fixed';
            confetti.style.fontSize = '25px';
            confetti.style.left = Math.random() * window.innerWidth + 'px';
            confetti.style.top = '-50px';
            confetti.style.zIndex = '1000';
            confetti.style.pointerEvents = 'none';
            
            document.body.appendChild(confetti);
            
            const animation = confetti.animate([
                { transform: 'translateY(-50px) rotate(0deg)', opacity: 1 },
                { transform: `translateY(${window.innerHeight + 50}px) rotate(360deg)`, opacity: 0 }
            ], {
                duration: 2000 + Math.random() * 1000,
                easing: 'ease-out'
            });
            
            animation.onfinish = () => {
                confetti.remove();
            };
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            createDemoBoard();
            selectPiece('pawn'); // Start with pawn
            showCelebration('üöÄ Welcome to Movement Mastery! Click on pieces to learn how they move!');
        });
    </script>
<script>
  localStorage.setItem("visited_moves", "true"); // change the key per page
</script>
<script src="progress.js"></script>
<script src="progress.min.js"></script>

</body>
</html>